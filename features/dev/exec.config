#!/usr/bin/env bash

set -eufo pipefail

# Install github cli gh, pin to version to allow checksum compare
# On update, update both GH_CSUM and the download url
ARCH=$(dpkg --print-architecture)
declare -A GH_CSUM
GH_CSUM=( ["amd64"]="652a1ed8c411d6a5237fead3af210063dd8263035f0454720b7728a6f21e94e6" ["arm64"]="06af3ff1cb2dd5b70888177388fbf128d1d3a90a590d43ff5424751d331fabac")
curl -fsSL https://github.com/cli/cli/releases/download/v2.40.1/gh_2.40.1_linux_$ARCH.deb --output gh.deb
calculated_checksum=$(sha256sum gh.deb | awk '{ print $1 }')
if [ ${GH_CSUM[$ARCH]} == "$calculated_checksum" ]; then
    apt install -y ./gh.deb
    rm gh.deb
else
    echo "Checksums do not match"
    exit 1
fi
